<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å“¡å·¥æ¢ç¢¼ç”Ÿæˆå™¨</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs2@0.0.2/qrcode.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Microsoft JhengHei', Arial, sans-serif;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      padding: 40px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 10px;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 40px;
    }

    .input-section {
      background: #f8f9fa;
      padding: 30px;
      border-radius: 10px;
      margin-bottom: 30px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr 2fr;
      gap: 15px;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    label {
      font-weight: bold;
      margin-bottom: 8px;
      color: #333;
    }

    input, select {
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #667eea;
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    button {
      padding: 12px 30px;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-add {
      background: #4CAF50;
      color: white;
    }

    .btn-add:hover {
      background: #45a049;
    }

    .btn-generate {
      background: #2196F3;
      color: white;
    }

    .btn-generate:hover {
      background: #0b7dda;
    }

    .btn-print-all {
      background: #ff9800;
      color: white;
    }

    .btn-print-all:hover {
      background: #e68900;
    }

    .btn-clear {
      background: #f44336;
      color: white;
    }

    .btn-clear:hover {
      background: #da190b;
    }

    .btn-test {
      background: #9c27b0;
      color: white;
    }

    .btn-test:hover {
      background: #7b1fa2;
    }

    .employee-list {
      margin-bottom: 30px;
    }

    .employee-list h2 {
      margin-bottom: 15px;
      color: #333;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    th {
      background: #667eea;
      color: white;
      font-weight: bold;
    }

    tr:hover {
      background: #f5f5f5;
    }

    .btn-delete {
      padding: 6px 15px;
      background: #f44336;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }

    .btn-delete:hover {
      background: #da190b;
    }

    .barcode-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 30px;
      margin-top: 20px;
    }

    .barcode-card {
      background: white;
      border: 3px solid #667eea;
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      page-break-inside: avoid;
    }

    .barcode-card h3 {
      color: #667eea;
      margin-bottom: 10px;
      font-size: 24px;
    }

    .barcode-card .dept {
      color: #666;
      font-size: 18px;
      margin-bottom: 15px;
    }

    .barcode-card .qrcode-container {
      margin: 20px auto;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .barcode-card .emp-id {
      font-size: 16px;
      color: #333;
      font-weight: bold;
      margin-top: 10px;
    }

    .empty-state {
      text-align: center;
      padding: 60px;
      color: #999;
      font-size: 18px;
    }

    @media print {
      body {
        background: white;
        padding: 0;
      }

      .container {
        box-shadow: none;
        padding: 0;
      }

      .input-section,
      .employee-list,
      .button-group,
      h1, .subtitle {
        display: none !important;
      }

      .barcode-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        padding: 20px;
      }

      .barcode-card {
        border: 2px solid #333;
        margin-bottom: 20px;
      }
    }

    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }

      .barcode-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ‘¥ å“¡å·¥ QR Code ç”Ÿæˆå™¨</h1>
    <p class="subtitle">æ‰¹é‡ç”Ÿæˆå“¡å·¥è­‰ QR Code,å¯ç”¨æ–¼å·¥å–®è¨ˆæ™‚ç³»çµ±ç™»å…¥ (æ”¯æ´ä¸­æ–‡)</p>

    <!-- è¼¸å…¥å€ -->
    <div class="input-section">
      <h2>ğŸ“ æ–°å¢å“¡å·¥</h2>
      <div class="form-row">
        <div class="form-group">
          <label>å“¡å·¥å·¥è™Ÿ *</label>
          <input type="text" id="empId" placeholder="ä¾‹å¦‚: A2005">
        </div>
        <div class="form-group">
          <label>éƒ¨é–€ä»£è™Ÿ *</label>
          <select id="deptCode">
            <option value="CM03">SMT (CM03)</option>
            <option value="CM04">æ¸¬è©¦ (CM04)</option>
            <option value="CM05">åŒ…è£ (CM05)</option>
            <option value="CM06">ç¶­ä¿® (CM06)</option>
            <option value="CM02">å» å‹™ç®¡ç†éƒ¨ (CM02)</option>
          </select>
        </div>
        <div class="form-group">
          <label>å“¡å·¥å§“å *</label>
          <input type="text" id="empName" placeholder="ä¾‹å¦‚: æ—ç¾éº—">
        </div>
      </div>
      <div class="button-group">
        <button class="btn-add" onclick="addEmployee()">â• åŠ å…¥å“¡å·¥</button>
        <button class="btn-generate" onclick="generateAllBarcodes()">ğŸ·ï¸ ç”Ÿæˆæ‰€æœ‰ QR Code</button>
        <button class="btn-test" onclick="addTestData()">ğŸ§ª è¼‰å…¥æ¸¬è©¦è³‡æ–™</button>
        <button class="btn-print-all" onclick="printAll()">ğŸ–¨ï¸ åˆ—å°å…¨éƒ¨</button>
        <button class="btn-clear" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©ºå…¨éƒ¨</button>
      </div>
    </div>

    <!-- å“¡å·¥æ¸…å–® -->
    <div class="employee-list" id="employeeListSection">
      <h2>ğŸ“‹ å“¡å·¥æ¸…å–® (<span id="employeeCount">0</span> äºº)</h2>
      <div id="employeeTable"></div>
    </div>

    <!-- æ¢ç¢¼é¡¯ç¤ºå€ -->
    <div id="barcodeSection">
      <h2>ğŸ·ï¸ å“¡å·¥ QR Code</h2>
      <div class="barcode-grid" id="barcodeGrid"></div>
    </div>
  </div>

  <script>
    let employees = [];

    const deptNames = {
      'CM03': 'SMT',
      'CM04': 'æ¸¬è©¦',
      'CM05': 'åŒ…è£',
      'CM06': 'ç¶­ä¿®',
      'CM02': 'å» å‹™ç®¡ç†éƒ¨'
    };

    // æ–°å¢å“¡å·¥
    function addEmployee() {
      const empId = document.getElementById('empId').value.trim();
      const deptCode = document.getElementById('deptCode').value;
      const empName = document.getElementById('empName').value.trim();

      if (!empId || !deptCode || !empName) {
        alert('âŒ è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½!');
        return;
      }

      // æª¢æŸ¥æ˜¯å¦é‡è¤‡
      if (employees.some(e => e.empId === empId)) {
        alert('âŒ æ­¤å·¥è™Ÿå·²å­˜åœ¨!');
        return;
      }

      employees.push({
        empId: empId,
        deptCode: deptCode,
        empName: empName
      });

      // æ¸…ç©ºè¼¸å…¥
      document.getElementById('empId').value = '';
      document.getElementById('empName').value = '';

      updateEmployeeTable();
      generateAllBarcodes();
      alert(`âœ“ å·²æ–°å¢å“¡å·¥: ${empName}`);
    }

    // æ›´æ–°å“¡å·¥è¡¨æ ¼
    function updateEmployeeTable() {
      const container = document.getElementById('employeeTable');
      const countElement = document.getElementById('employeeCount');
      
      countElement.textContent = employees.length;

      if (employees.length === 0) {
        container.innerHTML = '<div class="empty-state">å°šæœªæ–°å¢ä»»ä½•å“¡å·¥<br>é»æ“Šã€ŒğŸ§ª è¼‰å…¥æ¸¬è©¦è³‡æ–™ã€å¿«é€Ÿé–‹å§‹</div>';
        return;
      }

      let html = `
        <table>
          <thead>
            <tr>
              <th>åºè™Ÿ</th>
              <th>å“¡å·¥å·¥è™Ÿ</th>
              <th>éƒ¨é–€</th>
              <th>å“¡å·¥å§“å</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody>
      `;

      employees.forEach((emp, index) => {
        html += `
          <tr>
            <td>${index + 1}</td>
            <td><strong>${emp.empId}</strong></td>
            <td>${deptNames[emp.deptCode]} (${emp.deptCode})</td>
            <td>${emp.empName}</td>
            <td>
              <button class="btn-delete" onclick="deleteEmployee(${index})">åˆªé™¤</button>
            </td>
          </tr>
        `;
      });

      html += `
          </tbody>
        </table>
      `;

      container.innerHTML = html;
    }

    // åˆªé™¤å“¡å·¥
    function deleteEmployee(index) {
      if (confirm(`ç¢ºå®šè¦åˆªé™¤ ${employees[index].empName} å—?`)) {
        employees.splice(index, 1);
        updateEmployeeTable();
        generateAllBarcodes();
      }
    }

    // ç”Ÿæˆæ‰€æœ‰ QR Code
    function generateAllBarcodes() {
      const container = document.getElementById('barcodeGrid');

      if (employees.length === 0) {
        container.innerHTML = '<div class="empty-state">è«‹å…ˆæ–°å¢å“¡å·¥<br>é»æ“Šä¸Šæ–¹ã€Œâ• åŠ å…¥å“¡å·¥ã€æˆ–ã€ŒğŸ§ª è¼‰å…¥æ¸¬è©¦è³‡æ–™ã€</div>';
        return;
      }

      container.innerHTML = '';

      employees.forEach((emp, index) => {
        const qrcodeData = `EMP-${emp.empId}-${emp.deptCode}-${emp.empName}`;

        const card = document.createElement('div');
        card.className = 'barcode-card';
        card.innerHTML = `
          <h3>${emp.empName}</h3>
          <div class="dept">${deptNames[emp.deptCode]} (${emp.deptCode})</div>
          <div class="qrcode-container" id="qrcode-${index}"></div>
          <div class="emp-id">å·¥è™Ÿ: ${emp.empId}</div>
        `;
        container.appendChild(card);

        // ç”Ÿæˆ QR Code
        setTimeout(() => {
          try {
            new QRCode(document.getElementById(`qrcode-${index}`), {
              text: qrcodeData,
              width: 200,
              height: 200,
              colorDark: "#000000",
              colorLight: "#ffffff",
              correctLevel: QRCode.CorrectLevel.H
            });
          } catch (error) {
            console.error('QR Code ç”Ÿæˆå¤±æ•—:', error);
            document.getElementById(`qrcode-${index}`).innerHTML = 
              `<div style="color: red;">QR Code ç”Ÿæˆå¤±æ•—</div>`;
          }
        }, 50 * index);
      });
    }

    // åˆ—å°å…¨éƒ¨
    function printAll() {
      if (employees.length === 0) {
        alert('âŒ æ²’æœ‰ QR Code å¯ä»¥åˆ—å°!');
        return;
      }

      generateAllBarcodes();
      
      setTimeout(() => {
        window.print();
      }, 1000);
    }

    // æ¸…ç©ºå…¨éƒ¨
    function clearAll() {
      if (employees.length === 0) {
        alert('ç›®å‰æ²’æœ‰ä»»ä½•è³‡æ–™');
        return;
      }

      if (confirm('âš ï¸ ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰å“¡å·¥å’Œ QR Code å—?æ­¤æ“ä½œç„¡æ³•å¾©åŸ!')) {
        employees = [];
        updateEmployeeTable();
        document.getElementById('barcodeGrid').innerHTML = '<div class="empty-state">å·²æ¸…ç©ºæ‰€æœ‰è³‡æ–™</div>';
      }
    }

    // å¿«é€Ÿæ–°å¢æ¸¬è©¦è³‡æ–™
    function addTestData() {
      const testEmployees = [
        { empId: 'A2005', deptCode: 'CM03', empName: 'æ—ç¾éº—' },
        { empId: 'A2006', deptCode: 'CM04', empName: 'ç‹å¤§æ˜' },
        { empId: 'A2007', deptCode: 'CM05', empName: 'é™³å°è¯' },
        { empId: 'A2008', deptCode: 'CM06', empName: 'æå¿—æ˜' },
        { empId: 'A2009', deptCode: 'CM02', empName: 'å¼µæ·‘èŠ¬' }
      ];

      employees = [...testEmployees];
      updateEmployeeTable();
      generateAllBarcodes();
      alert('âœ“ å·²è¼‰å…¥ 5 ä½æ¸¬è©¦å“¡å·¥!');
    }

    // åˆå§‹åŒ–
    window.onload = function() {
      updateEmployeeTable();
      
      // æŒ‰ Enter è‡ªå‹•æ–°å¢
      document.getElementById('empName').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          addEmployee();
        }
      });

      console.log('âœ“ ç³»çµ±å·²å°±ç·’!é»æ“Šã€ŒğŸ§ª è¼‰å…¥æ¸¬è©¦è³‡æ–™ã€å¿«é€Ÿé–‹å§‹');
    };
  </script>
</body>
</html>